import streamlit as st
from PIL import Image
import numpy as np
import easyocr

st.set_page_config(page_title=✍️ Handwriting OCR", layout="centered")

st.title("✍️ Handwriting OCR App")
st.write("Upload an image or take a photo to extract handwritten text using EasyOCR.")

# Load OCR model once
@st.cache_resource
def load_reader():
    return easyocr.Reader(['en'])

reader = load_reader()

uploaded_file = st.file_uploader("Upload an image", type=["png", "jpg", "jpeg"])
camera_input = st.camera_input("Or take a photo")

image_source = camera_input or uploaded_file

if image_source is not None:
    image = Image.open(image_source).convert("RGB")
    st.image(image, caption="Uploaded Image", use_column_width=True)

    st.info("Processing handwriting... please wait.")
    img_array = np.array(image)
    results = reader.readtext(img_array)

    st.subheader("Recognized Text:")
    if results:
        full_text = []
        for (_, text, conf) in results:
            st.write(f"**{text}** (confidence: {conf:.2f})")
            full_text.append(text)
        st.markdown("---")
        st.markdown("**Combined Output:**")
        st.code(" ".join(full_text))
    else:
        st.warning("No text detected. Try a clearer image.")
else:
    st.info("Please upload or capture an image to start.")
